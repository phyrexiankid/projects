<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-3</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>fcc = 1;
//show_debug = -1;
x= view_xview[0]+view_wview[0]/2;
sw_mx=0;
sw_my=0;
sw_mxs=0;
sw_mys=0
swipe=0;
swipe_time=0;
swipe_speed=0;
mouse_xp = 0;
mouse_yp = 0;
shop_swipe = 0; 
long_press=0;
samor_y=sprite_get_height(sp_main_tile_up)/2.5+20;
opk=0;
osk = 0;
orre=string('0');
ots1 = sprite_get_height(sp_main_tile_up)+15;
ots2 = view_xview[0]+view_wview[0]/2;
ymax=sprite_get_height(sp_main_plash)/2;
ymax=view_hview[0]/2-190+ymax+obj_controller.mn*11;
ymin=view_hview[0]+100;

shop_pos[0]=0;
shop_pos[1]=0;
shop_pos[2]=0;
shop_pos[3]=0;

//слайды
t=0;
move_side=-1;
shiftt=0;
stopped = 1;
close_time = 20//5+10/global.spd;//10
shift_speed = 9.74*global.mult;//37.1;

//////////////////////////////



if file_exists('data.sav'){

var general_map=ds_map_create();
if file_exists("data.sav") general_map = ds_map_secure_load("data.sav"); 
if is_undefined(ds_map_find_value(general_map,"shop_map")) {
  //андефаинд он может быть в случае, если мы на старом сохранении или никакого нет
  if file_exists('Save.sav') {/*-*/
    //если на старом, в последний раз выкачиваем все из него и сразу сохраняем по новому
    ini_open('Save.sav');/*-*/
    for(sc=1;sc&lt;51;sc++){
        shop_upgrade_bonus[sc]  = ini_read_real('shop_upgrade_bonus',"shop_upgrade_bonus["+string(sc)+"]",0);
        shop_cost[sc]           = ini_read_real('obj_shop_cost','shop_cost['+string(sc)+']',0)
    
        for(su=0;su&lt;5;su++){
            shop_upgrade[sc,su] = ini_read_real('obj_shop','shop_upgrade['+string(sc)+','+string(su)+']',0);
        }
    }
    for(var to = 101; to&lt;118; to++){ //меин апгрейды, которые равны 1, создаем
        var nnnuttt = string(to);
        shop_upgrade_main[to]=ini_read_real('obj_upgrade_tab_main',nnnuttt,0);
    }
    ini_close();
    scr_save_shop();
  }

} else { 

  //если он есть, то мы любо нормально загружаемся, либо первый раз загружаемся
  //в любом случае делаем лоад
  scr_load_shop();
}
} else scr_load_shop(); //точней вот тут первый раз

sw3 = sprite_get_width(sp_main_tile_fill)*2;
sw2 = sprite_get_width(sp_main_tile_down)*2;
sw4 = sprite_get_height(sp_main_tile_up)/2;

//upgrades list, list, popups list
child_list[0] =     ds_list_create();
child_list[1] =     ds_list_create();
child_list[2] =     ds_list_create();
child_list[3] =     ds_list_create();
popup_list =        ds_list_create();
cost_list_shop =    ds_list_create();//--списки с ценами для магаза и апгрейда
cost_map_upgr  =    ds_map_create();//--чтоб определять цены когда табы деактивейтед

ds_list_clear(child_list[1]);
ds_list_clear(child_list[2]);
ds_list_clear(child_list[3]);
ds_list_clear(popup_list);
ds_list_clear(cost_list_shop);
ds_map_clear(cost_map_upgr);

//shop - создаем плашки магаза
var i = 0;
for(i=0;i&lt;50;i++)
{
var in = instance_create(x,y,obj_shop_tab);
in.num = i+1;
in.x_shift = x;
in.y_shift = 270*(i+1);
in.target=id;
in.visible=0;
ds_list_add(child_list[1],in);
ds_list_add(cost_list_shop,i+1);//пихаем в лист цен 50 заглушек
}

var stts=instance_create(0,0,obj_stats_tab);
stts.target=id;
stts.y_shift=100;
stts.visible=0;
ds_list_add(child_list[3],stts);

// PARTICLES
particle_ore = part_system_create()
part_system_depth(particle_ore, -1 );

alarm[0]=room_speed;
alarm[2]=room_speed;
alarm[7]=room_speed/2;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="7">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string> ///make ore string

orre = string(floor(global.ore_count/global.costmod));

var tempNumber = string_length(orre);

var ds=0;//dopolnit. space
for(var i=0; i&lt;7; i++) {
  if tempNumber &gt; (21-(3*i)) {
    orre = string_insert(" ", orre, ds+tempNumber-(20-(3*i)));
    ds++;
  }
} 

alarm[7]=room_speed/6;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="6">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///запасной степ

orre = string(global.ore_count/global.costmod);


if string_pos('.', string(orre)) = 0 orre=string(orre)+string('.00');
var tempNumber = string_length(orre);

if tempNumber &gt; 6 {
    orre = string_insert(" ", orre, tempNumber-5);
    if tempNumber &gt; 9 {
        orre = string_insert(" ", orre, tempNumber-8);
        if tempNumber &gt; 12 {
            orre = string_insert(" ", orre, tempNumber-11);
            if tempNumber &gt; 15 {
                orre = string_insert(" ", orre, tempNumber-14);
            }
        }
    }
}
orre=string_delete(orre,string_length(orre)-2,3);



if global.screen = 1 or global.screen = 2 or global.screen = 3
{
if obj_controller.to_shop = 0
{
//visible=1; 
if device_mouse_check_button_pressed(0,mb_left) and mouse_y &gt; room_height/2 and global.popup_open = 0
{
    swipe=1;
    sw_mxs=mouse_x;
    sw_mys=mouse_y;
    mouse_xp = mouse_x;
    mouse_yp = mouse_y;
    
}

if swipe=1
{
    sw_mx=mouse_x;
    sw_my=mouse_y;
    swipe_time++;
    swipe_speed=point_distance(x,mouse_yp,x,sw_my);
    speed=swipe_speed;
    direction=point_direction(x,mouse_yp,x,sw_my);

    if device_mouse_check_button_released(0,mb_left)
       {
       /*swipe=0;
       swipe_speed=point_distance(x,sw_mys,x,sw_my)/swipe_time;
       swipe_time=0;
       var i1=scr_swipe_check(x,sw_mys,x,sw_my);
       speed=swipe_speed;
       direction=point_direction(x,sw_mys,x,sw_my);  */
       swipe=0;
       swipe_time=0;
       swipe_speed=point_distance(x,mouse_yp,x,sw_my);
       speed=swipe_speed;
       direction=point_direction(x,mouse_yp,x,sw_my);
       }
    mouse_xp = mouse_x;
    mouse_yp = mouse_y;
    
}
else
{

    if y&gt;room_height/2-120
    {
        speed=0
        y-=point_distance(x,y,x,room_height/2-120)/4;
    }
    else if y+270*global.shop_items_number&lt;room_height-150
    {    
        speed=0 
        y+=point_distance(x,y+270*global.shop_items_number,x,room_height-150)/4;
    }
    
}

if speed &gt; 0 speed-=0.6;
if speed &lt; 0 speed=0;
}
}
//else visible=0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="5">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///new ore sound
if global.sound = 1{
    var snd = choose(snd_gold_1,snd_gold_2,snd_gold_3);
    audio_play_sound(snd, 1, 0);
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="4">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// sound
if global.sound = 1{
    var snd = choose(/*snd_gnoome_1,*/snd_gnoome_2,snd_gnoome_3,snd_gnoome_4);
    audio_play_sound(snd, 1, 0);
    audio_sound_pitch(snd, random_range(0.95,1.05));
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///per sec counting

var oore = global.ore_per_second+(global.ore_per_second/100*obj_controller.boost_mode_perc);
osk = string(oore/global.costmod);


if string_pos('.', string(osk)) = 0 osk=string(osk)+string('.00');
var tempNumber = string_length(osk);

if tempNumber &gt; 3 {
    osk = string_insert(" ", osk, tempNumber-5);
    if tempNumber &gt; 6 {
        osk = string_insert(" ", osk, tempNumber-8);
        if tempNumber &gt; 9 {
            osk = string_insert(" ", osk, tempNumber-11);
            if tempNumber &gt; 12 {
                osk = string_insert(" ", osk, tempNumber-14);
            }
        }
    }
}
osk=string_delete(osk,string_length(osk),1);
draw_set_font(obj_controller.main_font3);
opk = string_width(osk)/2-5;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///cost/bonus saving

/*ini_open('Save.sav');

for(var i=1;i&lt;51;i++){
    ini_write_real('obj_shop_cost',     string("shop_cost[")+string(i)+string("]"),         shop_cost[i]);
    ini_write_real('shop_upgrade_bonus',string('shop_upgrade_bonus[')+string(i)+string(']'),shop_upgrade_bonus[i]);
}

//ini_close();*/

scr_save_shop();
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// sorting



 for(var to2 = 0; to2&lt;17; to2++){
        if shop_upgrade_main[to2] = 1{
            //var up = instance_create(0,0,obj_upgrade_tab_main ); 
            var to3=to2+101;
            var tonum2=0;
            //up.num=to3;
                 if to3 = 101 tonum2 = 0;           
            else if to3 = 102 tonum2 = 1;
            else if to3 = 103 tonum2 = 2;
            else if to3 = 104 tonum2 = 3;
            else if to3 = 105 tonum2 = 4;
            else if to3 = 106 tonum2 = 0;
            else if to3 = 107 tonum2 = 1;
            else if to3 = 108 tonum2 = 0;
            else if to3 = 109 tonum2 = 1;
            else if to3 = 110 tonum2 = 0;
            else if to3 = 111 tonum2 = 1;
            else if to3 = 112 tonum2 = 0;
            else if to3 = 113 tonum2 = 1;
            else if to3 = 114 tonum2 = 1;
            else if to3 = 115 tonum2 = 1;
            else if to3 = 116 tonum2 = 2;
            else if to3 = 117 tonum2 = 3;
            
            scr_create_upgrade_main(to3,tonum2)
            
        } 
        if shop_upgrade_main[to2]=2 and to2=13{
            if obj_controller.max_base_click &gt; obj_controller.lvl_base_click{
                scr_create_upgrade_main(114,1)
            }
        }   
    }
    
        if shop_upgrade_main[0] = 2{
        instance_create(0,0,obj_bonus_button);
    }
    
    





</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>


if global.screen != 0 and global.popup_open = 0 and obj_controller.to_shop=0 and obj_controller.to_main=0
{

if device_mouse_check_button_pressed(0,mb_left) and mouse_y &gt; room_height/2 {
    swipe=1;
    sw_mxs=device_mouse_raw_x(0);
    sw_mys=device_mouse_raw_y(0);
    mouse_xp = device_mouse_raw_x(0);
    mouse_yp = device_mouse_raw_y(0);
}

if swipe=1 {
    if device_mouse_check_button_released(0,mb_left) {
       swipe=0;
       swipe_time=0;
    } else {
        sw_mx=device_mouse_raw_x(0);
        sw_my=device_mouse_raw_y(0);
        swipe_time++;
        swipe_speed=point_distance(x,mouse_yp,x,sw_my);
        speed=swipe_speed;
        direction=point_direction(x,mouse_yp,x,sw_my);
    }
    mouse_xp = device_mouse_raw_x(0);
    mouse_yp = device_mouse_raw_y(0);
} else {
    if y&gt;room_height/2-120 {
        speed=0
        y-=point_distance(x,y,x,room_height/2-120)/(6/global.mult);
    } else if y+270*global.shop_items_number&lt;room_height-150 {    
        speed=0 
        y+=point_distance(x,y+270*global.shop_items_number,x,room_height-150)/(6/global.mult);
    }
    
}
    if speed &gt; 0 {speed*=0.95;if speed&lt;0.5 speed=0}/*speed-=(2.5)*/
    else if speed &lt; 0 speed=0;
} else speed=0;


//двигаем весь лист
if speed!=0 or y!=yprevious {
for(var i=0; i&lt;ds_list_size(child_list[global.screen]); i++) {
    with ds_list_find_value(child_list[global.screen],i) {
        
        //x=target.x+x_shift;
        y=other.y+y_shift;
        if global.screen!=3{ 
        visible=0;
        if y&gt;other.ymax and y&lt;other.ymin visible=1;} else visible=1;
    }
}
}



</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
//строка сколько ресурсов добыто
draw_set_font(obj_controller.main_font2);
draw_set_color(obj_controller.main_color);
draw_set_valign(fa_middle);
draw_set_halign(fa_center);
draw_sprite_ext(sp_main_samorodok,obj_controller.ore_picture,ots2-string_width(orre)/2- 75,sw4,1,1,0,obj_controller.ore_color,1);
draw_set_color(obj_controller.ore_color);//вверху самородок

draw_text(ots2,sw4,orre);//добыто руды
draw_set_color(obj_controller.main_color);
draw_set_font(obj_controller.main_font3);

draw_set_halign(fa_center); 
draw_text(ots2,ots1,osk);//руды в сеунду
draw_set_halign(fa_left); 
draw_set_color(obj_controller.main_color_ore);
draw_text(ots2+opk,ots1,obj_controller.l_persec);

with obj_controller {
//свечение снизу
draw_sprite_ext(sp_lightning,0,view_xview[0],view_hview[0]-120-up_mode2*1.02,lightning_lenght,1,0,ore_color,obj_button_shop.light_alpha);
}
//
//draw_sprite(sp_enabled_count,0,room_width/2,y);
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
